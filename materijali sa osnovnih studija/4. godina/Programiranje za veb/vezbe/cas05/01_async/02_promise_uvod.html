<!DOCTYPE html>
<html lang="en"> 
<head>
    <meta charset="UTF-8">
    <title> Asinhrono prigramiranje </title>
</head>
<body>
    <h3> Promise konstruktor i then </h3>
    <script type="text/javascript">
        // obecanja su drugi nacin za obradu zahteva (umesto obicnih callbackova)
        // Promise je kao neki wrapper oko necega sto treba da dobijemo iz zahteva, dakle u nekom trenutku nas promise
        // ne mora imati tu vrednsot u sebi, ali kada se zahtev izvrsi, u promise ce se upisati vrednost
        // obecanje moze i da se ne ispuni, u tom slucaju to mora da se obradi u kodu
        // ova funkcija ne blokira, tj desavace se asinhrono, a u trenutku kada se u primise upise vrednost, tada se poziva callback koji navedemo u njemu

        document.body.appendChild(document.createTextNode(" 1 "));

        // promise objketu se prosledjuje neka funkcija (koja se zove executor funkcija (?)) koja treba da ima 2 callbacka koja
        // se pozivaju kada se promise ispuni/ne ispuni (?) (u praksi se cesto zovu resolve i reject)
        const promise = new Promise(function(resolve, reject){
            // primetimo da se ovo u telu fukncije izvrsava asinhrono, tj do sada je program ispisao "1", a sada ce ispisati i "2", a nece skociti
            // odmah na stampanje "3" ispod.
            // tj ova funkcija se pozvala sinhronosa globalnim kontekstom
            document.body.appendChild(document.createTextNode(" 2 "));

            // sta tacno ovo radi (?)
            resolve("Obecanje je ispunjeno")
        });

        document.body.appendChild(document.createTextNode(" 3 "));

        setTimeout(function(){
            document.body.appendChild(document.createTextNode(" 4 "));
        }, 0);

        // sa then dohvatamo onaj trenutak kada se u promise-u nalazi potrebna vrednost
        // dakle kada se promise ispuni, poziva se funkcija koja se prosledi kao argument
        // then se nece pozvati dok se obecanje ne ispuni ili dok se ne odbaci
        // funkcija koja se salje kao argument mora bas da bude ovog formata, tj da prima jedan argument (Koji ne mora da se zove value
        // ali to je praksa, jer je to bas vrednost koja ce bitri upisana u promise)
        // NOTE: resolve i reject nemaju nikakve veze sa then i nece se pojaviti u ovom koraku 'otpakivanja obecanja', 
        // oni se koriste samo iznad pri konstrukciji i sluze da nam kazu da li se obecanje ispunilo ili odbacilo
        promise.then(function(value){
            // ovo se NE izvrsava asinhrono nego pocinje tek kada se obecanje ispuni
            document.body.appendChild(document.createTextNode(value));
        });
    </script>
</body>
</html>